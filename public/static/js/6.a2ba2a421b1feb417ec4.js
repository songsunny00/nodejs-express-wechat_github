webpackJsonp([6],{"8xsm":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a,n=i("//Fk"),s=i.n(n),o=i("Dd8w"),r=i.n(o),l=i("Ssqh"),c=i("TIfe"),d=i("NYxO"),u={name:"detail",computed:r()({},Object(d.b)(["location"])),data:function(){return{activeNames:["0","1","2","3"],info:{},orderStatus:"",fullscreenLoading:!1,dialogVisible:!1,imgSrc:[],imgBase64s:[],typeArray:[],pictureList:[]}},mounted:function(){var t=this.$route.query;this.orderNo=t.orderNo,this.orderStatus=t.orderStatus,this.fetchData()},methods:{handleChange:function(t){console.log(t)},removeImg:function(t){console.log(t),this.imgSrc.splice(t,1),this.imgBase64s.splice(t,1),this.typeArray.splice(t,1)},onTapChooseImg:function(){var t=this;(a=document.getElementById("myUploadInput")).click();var e=5;a.onchange=function(){if(a.value)if(e&&a.files[0].size>1024*e*1024)t.$message({type:"warning",message:"请上传小于"+e+"M的文件"});else{var i=(new Date).getTime(),n=a.files[0].name,s=(n.indexOf("."),n.length,a.files[0].type),o=new File([a.files[0]],"wechat_"+Object(c.f)()+i+"-"+Object(c.c)()+"-1."+s),r=new FileReader;r.readAsArrayBuffer(o);var l=new Image;r.onload=function(){var e=document.createElement("canvas"),i=e.getContext("2d");l.src=this.result,l.onload=function(){e.width=1080,e.height=l.height/l.width*1080,i.drawImage(l,0,0,e.width,e.height),l.src=e.toDataURL("image/png",.6)},t.imgBase64s.push(this.result),t.typeArray.push(s)},t.getReaderImg(o)}}},getReaderImg:function(t){var e=this,i=new FileReader;i.readAsDataURL(t),i.onload=function(t){var i=this.result;e.imgSrc.push(i),console.log(e.imgSrc)}},openLocation:function(t){console.log(t);var e=this.location.location;window.location.href="http://api.map.baidu.com/direction?origin=latlng:"+e.latitude+","+e.lontitude+"|name:我的位置&destination="+t+"&mode=driving&region="+this.location.addressComponent.city+"&output=html&src=速必达希杰物流"},onTapSignException:function(){var t=this;this.$prompt("请输入异常原因","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(e){var i=e.value;i?(t.cause=i,t.type="0",t.$store.dispatch("getCurrLocation").then(function(e){t.address=e.result.formatted_address,t.signTransport()})):t.$message({type:"error",message:"请输入异常原因"})})},onTapSignTransport:function(){var t=this;this.dialogVisible=!1,this.fullscreenLoading=!0;var e={imgBase64s:this.imgBase64s,typeArray:this.typeArray,transportNo:this.transportNo};this.$store.dispatch("Upload",e).then(function(e){t.type="1",t.cause="",t.address=t.location.formatted_address,console.log(e),t.pictureList=e,t.signTransport().then(function(){t.imgBase64s=[],t.typeArray=[],t.imgSrc=[],t.pictureList=[]})}).catch(function(){t.fullscreenLoading=!1})},fetchData:function(){var t=this;return new s.a(function(e,i){t.fullscreenLoading=!0;var a={userId:Object(c.c)(),orderNo:t.orderNo,status:t.orderStatus,pageSize:1,pageIndex:1};Object(l.c)(a).then(function(i){i.data&&(t.info=i.data[0],t.transportNo=i.data[0].transportNo),t.fullscreenLoading=!1,e(i.data)}).catch(function(e){t.fullscreenLoading=!1})})},signTransport:function(){var t=this;return new s.a(function(e,i){var a={userId:Object(c.c)(),transportNo:t.transportNo,type:t.type,cause:t.cause,address:t.address,longitude:t.location.location.lng,latitude:t.location.location.lat,prictureList:t.pictureList};t.fullscreenLoading=!0,Object(l.d)(a).then(function(i){t.fullscreenLoading=!1,t.$message({type:"success",message:i.info}),window.history.go(-1),e(i)}).catch(function(e){t.fullscreenLoading=!1})})}}},p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"detail-wrap"},[i("el-collapse",{on:{change:t.handleChange},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("el-collapse-item",{attrs:{title:"配送信息",name:"0"}},[i("div",[i("i",{staticClass:"el-icon-location"}),t._v(t._s(t.info.address)),i("span",{staticClass:"pull-right txt-blue",on:{click:function(e){t.openLocation(t.info.address)}}},[t._v("导航")])]),t._v(" "),i("div",[t._v("要求："+t._s(t.info.deliveryTime)+"送达")])]),t._v(" "),i("el-collapse-item",{attrs:{title:"订单信息",name:"1"}},[i("div",[t._v("配送单号："+t._s(t.info.gridNo))]),t._v(" "),i("div",[t._v("运单号："+t._s(t.info.transportNo))]),t._v(" "),i("div",[t._v("客户订单号："+t._s(t.info.customerNo))]),t._v(" "),i("div",[t._v("收货人："+t._s(t.info.consignee))]),t._v(" "),i("div",{staticClass:"pull-right",staticStyle:{"margin-top":"-40px","font-size":"26px","margin-right":"15px"}},[t.info.mobilePhone?i("a",{attrs:{href:"tel:"+t.info.mobilePhone}},[i("i",{staticClass:"el-icon-phone-outline"})]):t._e()])]),t._v(" "),i("el-collapse-item",{attrs:{title:"商品信息",name:"2"}},[i("div",{staticClass:"content-warp"},t._l(t.info.item,function(e,a){return i("el-card",{staticClass:"box-card"},[i("div",{staticClass:"item"},[i("p",[i("i",{staticClass:"el-icon-goods"}),t._v("商品名称："+t._s(e.productName))]),t._v(" "),i("p",[i("i",{staticClass:"el-icon-setting"}),t._v("件数："+t._s(e.qty)+"，重量："+t._s(e.weight)+"kg，体积："+t._s(e.volume)+"方")])])])}))]),t._v(" "),t.info.pictureList&&t.info.pictureList.length?i("el-collapse-item",{attrs:{title:"签收照片",name:"3"}},[i("div",{staticClass:"content-warp"},[i("el-card",{staticClass:"box-card"},[i("ul",{staticClass:"weui-uploader__files",staticStyle:{"margin-top":"9px"}},t._l(t.info.pictureList,function(t,e){return i("li",{staticClass:"weui-uploader__file"},[i("img",{staticStyle:{width:"100%",height:"77px"},attrs:{src:t}})])}))])],1)]):t._e()],1),t._v(" "),"1"==t.orderStatus?i("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"footer-btn clearfix"},[i("div",{staticClass:"width-50 pull-left align-center"},[i("el-button",{staticClass:"width-80",attrs:{type:"primary"},on:{click:t.onTapSignException}},[t._v("登记异常")])],1),t._v(" "),i("div",{staticClass:"width-50 pull-left align-center"},[i("el-button",{staticClass:"width-80",attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("送达完成")])],1)]):t._e(),t._v(" "),i("el-dialog",{attrs:{title:"签收",visible:t.dialogVisible,width:"90%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("div",{staticClass:"weui-uploader__bd"},[i("ul",{staticClass:"weui-uploader__files",attrs:{id:"uploaderFiles"}},t._l(t.imgSrc,function(e,a){return i("li",{staticClass:"weui-uploader__file",staticStyle:{position:"relative"}},[i("img",{staticStyle:{width:"100%",height:"77px"},attrs:{src:e}}),t._v(" "),i("span",{staticClass:"img-remove",on:{click:function(e){t.removeImg(a)}}},[i("i",{staticClass:"el-icon-remove"})])])})),t._v(" "),t.imgSrc.length<5?i("div",{staticClass:"weui-uploader__input-box",on:{click:t.onTapChooseImg}},[i("input",{staticStyle:{display:"none"},attrs:{type:"file",name:"file",id:"myUploadInput"}})]):t._e()]),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary",disabled:0==t.imgBase64s.length},on:{click:t.onTapSignTransport}},[t._v("确 定")])],1)])],1)},staticRenderFns:[]};var g=i("VU/8")(u,p,!1,function(t){i("uR40")},"data-v-4f37cdc0",null);e.default=g.exports},F4gT:function(t,e,i){(t.exports=i("FZ+f")(!1)).push([t.i,"\n.detail-wrap[data-v-4f37cdc0] {\n  font-size: 15px !important;\n  margin: 0 10px;\n}\n.detail-wrap .box-card[data-v-4f37cdc0] {\n    margin: 10px 0;\n}\n.detail-wrap .box-card .item[data-v-4f37cdc0] {\n      line-height: 2;\n      padding: 10px 0;\n}\n.img-remove[data-v-4f37cdc0] {\n  position: absolute;\n  right: 0;\n  top: 0;\n  color: red;\n  font-size: 20px;\n}\n",""])},uR40:function(t,e,i){var a=i("F4gT");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i("rjj0")("40cd09b8",a,!0)}});